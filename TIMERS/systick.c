/*******************************************************************************************************************************//**
 * @details		Proyecto: Template
 * @file		DR_display.c
 * @brief		DESCRIPCION ---------------
 * @date		17/6/2016
 * @author		Ing. Marcelo Trujillo
 *
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/
#include <systick.h>
#include "timer.h"

/***********************************************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
 **********************************************************************************************************************************/
static void (*	g_callback)(void) = NULL;		//!< Handler de intercepcion del SysTickHandler

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** PROTOTIPO DE FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

 /***********************************************************************************************************************************
 *** FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

 /***********************************************************************************************************************************
 *** FUNCIONES GLOBALES AL MODULO
 **********************************************************************************************************************************/

/**
	@fn  		void InicializarSystick( uint32_t us )
	@brief 		configura el Systick
 	@author 	Ing. Marcelo Trujillo
 	@date 		17-06-16
 	@param void
	@return void
*/
void InicializarSystick( uint32_t us )
{
	SysTick->LOAD = SystemCoreClock/1000000 * us;
	if( (SIM->BUSDIV & SIM_BUSDIV_BUSDIV_MASK) == 0x01)	//si BUS_CLOCK = SYSTEM_CLOCK/2
		SysTick->LOAD <<= 1;							//multiplico por 2
	SysTick->VAL = 0;
	SysTick->CTRL = 0x07;
	SysTick_SetCallback( SysTick_InterruptCallback );
}

/**
	@fn  		void SysTick_Handler( void )
	@brief 		Systick Handler
 	@author 	Ing. Marcelo Trujillo
 	@date 		17-06-16
 	@param void
	@return void
*/
void SysTick_Handler( void )
{
	if(g_callback)
		g_callback();
}

void SysTick_SetCallback( void (*callback)(void) )
{
	g_callback = callback;
}
